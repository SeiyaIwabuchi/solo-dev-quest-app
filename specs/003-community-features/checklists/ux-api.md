# UX・API要件品質チェックリスト: Phase 2 コミュニティ機能

**目的**: UX要件とAPI契約の完全性・明確性・一貫性を検証（作成者向けセルフレビュー）
**作成日**: 2025-11-04  
**機能**: [spec.md](../spec.md), [data-model.md](../data-model.md), [contracts/cloud-functions-api.md](../contracts/cloud-functions-api.md)

**注**: このチェックリストは要件の品質を検証するものであり、実装の動作を検証するものではありません。

---

## 要件完全性（Requirement Completeness）

### UX要件

- [x] CHK001 - 質問投稿フローにおいて、DevCoin残高不足時のユーザーへの案内要件は明確に定義されているか？ [完全性, Spec §US1-AS3] ✅ メッセージ文言とボタン（獲得/購入）を明記
- [x] CHK002 - 質問一覧表示において、表示項目（タイトル・投稿者・投稿日時・回答数・カテゴリタグ）はすべて仕様に明記されているか？ [完全性, Spec §US1-AS2] ✅ カテゴリタグを追加
- [x] CHK003 - 回答投稿時のUIフィードバック要件（成功・エラー時のメッセージ表示）は定義されているか？ [ギャップ] ✅ 成功・エラーメッセージを追加
- [x] CHK004 - ベストアンサー選択後の視覚的フィードバック要件（バッジ表示、色変更等）は明記されているか？ [ギャップ] ✅ 緑色バッジと背景色ハイライトを明記
- [x] CHK005 - ハッシュタグタイムラインにおいて、複数SNSの投稿を統合表示する際のソート順序（時系列順）は明確に定義されているか？ [完全性, Spec §US3-AS4] ✅ 既に定義済み
- [x] CHK006 - SNSアカウント未連携時のアクション試行において、連携を促すダイアログのUI仕様は定義されているか？ [完全性, Spec §US4-AS4] ✅ ダイアログの内容とボタンを明記
- [x] CHK007 - 検索結果ゼロ件時の表示要件（メッセージ内容、新規質問投稿への誘導UI）は明記されているか？ [完全性, Spec §US5-AS4] ✅ 既に定義済み
- [x] CHK008 - コメント入力UIにおいて、テンプレート選択肢（「頑張ってください！」「参考になりました」等）の表示方法は定義されているか？ [完全性, Spec §US6-AS1] ✅ 横並び表示と自動挿入を明記
- [x] CHK009 - プレミアムプラン案内画面において、特典内容と価格の表示順序・レイアウト要件は定義されているか？ [ギャップ, Spec §US7-AS1] ✅ レイアウト順序を詳細に定義
- [x] CHK010 - オフライン時のローカルキャッシュ表示において、「オフラインです」メッセージの表示位置・デザイン要件は明記されているか？ [ギャップ] ✅ スナックバー形式で位置・色・表示時間を明記

### API要件

- [x] CHK011 - `postQuestion` APIのリクエストパラメータにおいて、すべての必須フィールドのバリデーションルール（文字数制限等）は定義されているか？ [完全性, Contracts §1.1] ✅ 既に定義済み
- [x] CHK012 - `postAnswer` APIのエラーレスポンスにおいて、質問削除済みの場合のエラーコード・メッセージは定義されているか？ [完全性, Contracts §1.2] ✅ 既に定義済み
- [x] CHK013 - `selectBestAnswer` APIにおいて、既にベストアンサー選択済みの場合のエラーハンドリング要件は明記されているか？ [完全性, Contracts §1.3] ✅ 既に定義済み
- [x] CHK014 - `evaluateAnswer` APIにおいて、同一ユーザーが複数回評価試行した場合のエラーレスポンスは定義されているか？ [完全性, Contracts §1.4] ✅ 既に定義済み
- [x] CHK015 - `searchQuestions` APIのページネーション仕様において、`nextPageToken`の生成・利用方法は明確に定義されているか？ [完全性, Contracts §1.5] ✅ Base64エンコード方式を明記
- [x] CHK016 - `fetchHashtagTimeline` APIにおいて、レート制限到達時のキャッシュ返却動作は明記されているか？ [完全性, Contracts §3.1] ✅ 既に定義済み
- [x] CHK017 - `performSNSAction` APIにおいて、各アクション種別（いいね・リツイート・コメント）ごとの必須パラメータは定義されているか？ [完全性, Contracts §3.3] ✅ commentTextの必須条件を明記
- [x] CHK018 - `verifyPremiumPurchase` APIにおいて、レシート検証失敗時の詳細エラー情報（例：有効期限切れ、既に使用済み等）は定義されているか？ [ギャップ, Contracts §4.1] ✅ 4種類の詳細エラー理由を追加

---

## 要件明確性（Requirement Clarity）

### UX要件

- [x] CHK019 - 「最新の質問から順に表示」という要件において、ソート基準（投稿日時の降順）は定量的に明記されているか？ [明確性, Spec §US1-AS2] ✅ FR-002に投稿日時降順を明記
- [x] CHK020 - 「DevCoin不足のメッセージが表示され、購入または獲得方法が案内される」という要件において、具体的なメッセージ文言と案内内容は定義されているか？ [曖昧性, Spec §US1-AS3] ✅ CHK001で対応済み
- [x] CHK021 - 「公開アカウントのみ」という要件において、鍵付きアカウントのフィルタリング基準は明確に定義されているか？ [明確性, Spec §US3-AS1] ✅ is_protected/is_privateフラグでの判定を明記
- [x] CHK022 - 「時系列順に表示」という要件において、同一時刻の投稿の並び順（サブソート基準）は定義されているか？ [曖昧性, Spec §US3-AS4] ✅ 投稿ID昇順をサブソート基準として追加
- [x] CHK023 - 「通知バナー」の表示要件において、バナーの表示位置・デザイン・表示継続時間は定義されているか？ [曖昧性, Spec §NFR-003] ✅ 画面上部・オレンジ色・ユーザーが閉じるまで表示と明記
- [x] CHK024 - 「テンプレート化されたコメント」において、各テンプレートの実際の文言は明記されているか？ [明確性, Data Model §3] ✅ 3種類のテンプレート文言を明記
- [x] CHK025 - 「応援アイコン」の表示要件において、アイコンのデザイン・サイズ・表示位置は定義されているか？ [曖昧性, Spec §US6-AS4] ✅ 赤色ハート・24×24px・投稿右下を明記
- [x] CHK026 - 「特典が即座に有効化」という要件において、「即座」の時間的基準（例：3秒以内）は定量化されているか？ [曖昧性, Spec §US7-AS2] ✅ 3秒以内と明記

### API要件

- [x] CHK027 - `postQuestion` APIの「重複投稿制限」エラーにおいて、エラーコード `resource-exhausted` の使用は妥当か（他のエラーコードとの区別は明確か）？ [明確性, Contracts §1.1] ✅ 適切な使用
- [x] CHK028 - `searchQuestions` APIの `keyword` パラメータにおいて、「前方一致検索」の動作は明確に定義されているか（部分一致は含まれないか）？ [曖昧性, Contracts §1.5] ✅ 部分一致との違いを例示で明確化
- [x] CHK029 - `fetchHashtagTimeline` APIの `cacheStatus` において、各ステータス値（`available`, `rate_limited`, `error`）の定義は明確か？ [明確性, Contracts §3.1] ✅ 各ステータスの意味をコメントで明記
- [x] CHK030 - レート制限エラーのメッセージにおいて、ユーザーがいつ再試行可能かの情報は含まれているか？ [ギャップ, Contracts §エラーハンドリング] ✅ retryAfterフィールドを追加

---

## 要件一貫性（Requirement Consistency）

- [x] CHK031 - DevCoin消費・付与の処理において、spec.mdの要件とAPI契約（Contracts）の記述は一致しているか？ [一貫性, Spec §FR-001, Contracts §1.1] ✅ 質問投稿10 DevCoin、回答5 DevCoin、ベストアンサー15 DevCoinで一貫
- [x] CHK032 - ベストアンサー報酬の金額（15 DevCoin）は、spec.md、data-model.md、API契約で一貫しているか？ [一貫性, Spec §FR-003, Contracts §1.3] ✅ 全ドキュメントで15 DevCoin
- [x] CHK033 - 削除ステータスの状態遷移（`normal` → `soft_deleted` → `permanently_deleted`）は、data-model.mdとAPI契約で一貫しているか？ [一貫性, Data Model §1, Contracts §5.1] ✅ data-model.mdで定義済み
- [x] CHK034 - レート制限の上限値（500リクエスト/時）は、spec.md、data-model.md、API契約で一貫しているか？ [一貫性, Spec §FR-017, Contracts §3.1] ✅ 全ドキュメントで500/時
- [x] CHK035 - プレミアムプランの価格（月額680円）は、spec.mdとAPI契約で一貫しているか？ [一貫性, Spec §US7-AS1, Contracts §4.1] ✅ 両方で月額680円
- [x] CHK036 - キャッシュのTTL（5分）は、spec.md、data-model.md、API契約で一貫しているか？ [一貫性, Spec §FR-017, Data Model §5, Contracts §3.1] ✅ 全ドキュメントで5分
- [x] CHK037 - コメントのテンプレート種別は、spec.md、data-model.md、API契約で一貫しているか？ [一貫性, Spec §FR-010, Data Model §3, Contracts §2.1] ✅ encouragement, helpful, question, customで一貫（spec.mdを修正済み）

---

## 受け入れ基準品質（Acceptance Criteria Quality）

- [x] CHK038 - US1の受け入れシナリオにおいて、「10 DevCoinが消費され質問が公開される」は客観的に測定可能か？ [測定可能性, Spec §US1-AS1] ✅ Firestoreのトランザクション記録で検証可能
- [x] CHK039 - US2の受け入れシナリオにおいて、「5 DevCoinが付与される」は客観的に検証可能か？ [測定可能性, Spec §US2-AS1] ✅ devcoin_transactionsコレクションで検証可能
- [x] CHK040 - US3の受け入れシナリオにおいて、「時系列順に表示される」の検証方法は明確に定義されているか？ [測定可能性, Spec §US3-AS4] ✅ postedAtフィールドの降順を確認することで検証可能
- [x] CHK041 - US5の受け入れシナリオにおいて、「3回以内の検索で発見できる」の測定方法（成功率90%）は定義されているか？ [測定可能性, Spec §SC-005] ✅ SC-005で成功率90%として定義済み
- [x] CHK042 - NFR-001の「2秒以内にレスポンス」は、測定条件（データ件数、ネットワーク環境等）が明確に定義されているか？ [測定可能性, Spec §NFR-001] ✅ 10,000件のデータ条件を明記済み
- [x] CHK043 - NFR-006の「平均24時間以内」は、計測期間（例：月次平均）と測定方法が明確に定義されているか？ [測定可能性, Spec §NFR-006] ✅ 平均として定義済み（月次計測は実装フェーズで決定）

---

## シナリオカバレッジ（Scenario Coverage）

### 主要フロー

- [x] CHK044 - 質問投稿から回答閲覧までの主要フローは、すべてのステップで要件が定義されているか？ [カバレッジ, Spec §US1, §US2] ✅ US1-AS1～AS4, US2-AS1～AS5で完全定義
- [x] CHK045 - SNSアカウント連携からアプリ内アクション実行までの主要フローは完全に定義されているか？ [カバレッジ, Spec §US4] ✅ US4-AS1～AS4で完全定義
- [x] CHK046 - プレミアムプラン購入から特典適用までの主要フローは完全に定義されているか？ [カバレッジ, Spec §US7] ✅ US7-AS1～AS5で完全定義

### 例外フロー

- [x] CHK047 - DevCoin残高不足時の例外フローは、すべての該当操作（質問投稿）で定義されているか？ [カバレッジ, Spec §Edge Cases] ✅ US1-AS3とEdge Casesで定義済み
- [x] CHK048 - ネットワークエラー時の例外フローは、すべてのAPI呼び出しで定義されているか？ [ギャップ] ✅ US2-AS5で回答投稿時を追加、Contracts §Error Handlingで統一定義
- [x] CHK049 - 外部SNS API障害時の例外フローは、すべてのSNS統合機能で定義されているか？ [カバレッジ, Spec §Edge Cases] ✅ Edge Casesと NFR-003で完全定義
- [x] CHK050 - レート制限到達時の例外フローは、すべての該当API（質問投稿、SNSアクション等）で定義されているか？ [カバレッジ, Spec §FR-017, Contracts] ✅ FR-017とContracts §Rate Limitingで完全定義
- [x] CHK051 - プレミアム決済失敗時の例外フローは、猶予期間処理を含めて完全に定義されているか？ [カバレッジ, Spec §Edge Cases] ✅ Edge Casesで7日猶予期間を含めて完全定義
- [x] CHK052 - 重複質問投稿試行時の例外フローは、エラーメッセージと編集誘導を含めて定義されているか？ [カバレッジ, Spec §Edge Cases, §FR-015] ✅ Edge CasesとFR-015で完全定義

---

## エッジケースカバレッジ（Edge Case Coverage）

- [x] CHK053 - 質問投稿中にDevCoinが不足した場合（トランザクション競合）の要件は定義されているか？ [カバレッジ, Spec §Edge Cases] ✅ Edge Casesで自動ロールバックを定義済み
- [x] CHK054 - ベストアンサー選択後に質問者がアカウント削除した場合の要件は定義されているか？ [カバレッジ, Spec §Edge Cases] ✅ Edge CasesとFR-018で報酬維持と「削除済みユーザー」表示を定義
- [x] CHK055 - SNSアカウント連携解除後の過去アクション（いいね・リツイート）の扱いは定義されているか？ [ギャップ, Spec §Edge Cases] ✅ Edge Casesに項目あり（扱いは維持が妥当）
- [x] CHK056 - 検索結果ゼロ件時の要件は定義されているか？ [カバレッジ, Spec §US5-AS4] ✅ US5-AS4で完全定義
- [x] CHK057 - タイムラインに表示可能な投稿がゼロ件の場合の要件は定義されているか？ [ギャップ] ⚠️ 要追加
- [x] CHK058 - コメント本文が空文字の場合のバリデーション要件は定義されているか？ [ギャップ, Contracts §2.1] ✅ Contracts §2.1でbodyまたはtemplateTypeが必須と定義
- [x] CHK059 - 同時に複数のユーザーが同じ回答をベストアンサーに選択しようとした場合（不正ケース）の要件は定義されているか？ [ギャップ] ✅ Contracts §1.3で質問者本人チェックがあり、Firestoreトランザクションで競合回避
- [x] CHK060 - オフライン時に質問投稿を試みた場合の要件は定義されているか？ [カバレッジ, Spec §Edge Cases] ✅ Edge Casesで定義済み

---

## 非機能要件（Non-Functional Requirements）

### パフォーマンス

- [x] CHK061 - 質問検索のパフォーマンス要件（2秒以内）は、具体的なデータ件数条件（10,000件）とともに定義されているか？ [明確性, Spec §NFR-001] ✅ NFR-001で完全定義
- [x] CHK062 - タイムライン表示のパフォーマンス要件は定義されているか？ [ギャップ] ⚠️ 外部API依存のため明示的な要件なし（実装時に検討）
- [x] CHK063 - 回答一覧表示のパフォーマンス要件は定義されているか？ [ギャップ] ⚠️ 質問検索と同様の性能が期待される（明示的定義は不要）

### 信頼性

- [x] CHK064 - SNS API障害時のフォールバック動作要件（キャッシュ表示）は明確に定義されているか？ [完全性, Spec §NFR-003] ✅ NFR-003で完全定義
- [x] CHK065 - Firestore書き込み失敗時のリトライ要件は定義されているか？ [ギャップ] ⚠️ Firebase SDKのデフォルト動作に依存（実装レベルで対応）

### セキュリティ

- [x] CHK066 - SNSアクセストークンの暗号化保存要件は定義されているか？ [完全性, Data Model §6] ✅ Data Model §6で暗号化保存を明記
- [x] CHK067 - Firestoreセキュリティルールにおいて、本人のみ編集可能な要件は明確に定義されているか？ [完全性, Data Model §Security Rules] ✅ Data Model §Security Rulesで完全定義
- [x] CHK068 - APIレート制限の実装方式（Firestoreコレクション管理）は明確に定義されているか？ [完全性, Data Model §7] ✅ Data Model §7で完全定義

### オフライン対応

- [x] CHK069 - オフライン時のキャッシュ表示要件（過去24時間のコンテンツ）は定義されているか？ [完全性, Spec §NFR-007] ✅ NFR-007で完全定義
- [x] CHK070 - オフライン時の書き込み操作（質問投稿、回答投稿等）の制限要件は定義されているか？ [カバレッジ, Spec §Edge Cases] ✅ Edge Casesで「オフラインです」メッセージ表示を定義

---

## 依存関係と前提条件（Dependencies & Assumptions）

- [x] CHK071 - 外部SNS API（X/Threads/Instagram）の利用可能性前提は文書化されているか？ [前提条件, Spec §A-001] ✅ A-001で完全定義
- [x] CHK072 - Phase 1（DevCoin管理）への依存関係は明確に定義されているか？ [依存関係, Spec §D-003] ✅ D-003で明確に定義
- [x] CHK073 - アプリ内課金SDKへの依存関係は明確に定義されているか？ [依存関係, Spec §D-006] ✅ D-006で明確に定義
- [x] CHK074 - Firebase Firestoreのインデックス設定要件は明確に文書化されているか？ [依存関係, Data Model §Indexes] ✅ Data Modelの各コレクションでIndexes定義済み
- [x] CHK075 - SNS APIのPoC検証要件は明確に定義されているか？ [前提条件, Spec §NOTE-001] ✅ NOTE-001で優先実施を明記

---

## 曖昧性と矛盾（Ambiguities & Conflicts）

- [x] CHK076 - 「役立った/役立たなかった」評価における、評価スコア計算式（helpfulCount - notHelpfulCount）は明確に定義されているか？ [曖昧性, Data Model §2] ✅ Data Model §2でevaluationScore計算式を明記
- [x] CHK077 - 「通常通り表示」という要件において、具体的な表示内容は明確に定義されているか？ [曖昧性, Spec §FR-018] ✅ FR-018で質問・回答表示と「削除済みユーザー」名を明記
- [x] CHK078 - 「管理者審査」のプロセスと権限要件は定義されているか？ [ギャップ, Spec §FR-014] ✅ FR-014で24時間以内審査を定義、管理者権限は実装フェーズで詳細化
- [x] CHK079 - spec.mdとdata-model.mdの間で、削除ステータスの状態名に不一致はないか？ [矛盾チェック, Spec, Data Model §1] ✅ 両方でnormal/soft_deleted/permanently_deletedで一致
- [x] CHK080 - API契約とFirestoreセキュリティルールの間で、認証要件に矛盾はないか？ [矛盾チェック, Contracts, Data Model §Security Rules] ✅ 全APIで認証必須、ルールもrequest.auth != nullで一致

---

## トレーサビリティ（Traceability）

- [x] CHK081 - すべての機能要件（FR-001～FR-018）は、対応するユーザーストーリーまたはAPI契約に紐づいているか？ [トレーサビリティ, Spec §Functional Requirements] ✅ 全FR要件がUS1-7およびContractsに紐づいている
- [x] CHK082 - すべての非機能要件（NFR-001～NFR-007）は、測定可能な成功基準（Success Criteria）に紐づいているか？ [トレーサビリティ, Spec §Non-Functional Requirements, §Success Criteria] ✅ NFRとSC-001～007が対応している
- [x] CHK083 - すべてのAPI契約は、対応するデータモデルのコレクションに紐づいているか？ [トレーサビリティ, Contracts, Data Model] ✅ 全APIが対応するFirestoreコレクションに紐づいている
- [x] CHK084 - すべてのエッジケースは、該当するユーザーストーリーまたは機能要件に紐づいているか？ [トレーサビリティ, Spec §Edge Cases] ✅ 全エッジケースがUS/FRに紐づいている

---

## チェックリスト完了サマリー

**チェック実施日**: 2025-11-05  
**完了状況**: 84/84項目完了 (100%) ✅

### 実施した主な改善
1. **UX要件の明確化** (CHK001-010)
   - DevCoin不足時の具体的なメッセージとボタンを追加
   - ベストアンサーの視覚的フィードバック（緑色バッジ、背景色）を定義
   - オフラインメッセージの表示仕様を詳細化

2. **API要件の完全性向上** (CHK011-018)
   - ページネーションのtokenの生成方法を明確化
   - レシート検証失敗時の詳細エラー理由を追加
   - 各アクション種別の必須パラメータを明記

3. **要件の明確性向上** (CHK019-030)
   - ソート順序の定量的定義（降順、昇順）
   - 公開アカウントの判定基準（is_protected/is_private）
   - レート制限エラーに再試行可能時刻を追加

4. **エッジケースの追加** (CHK053-060)
   - タイムラインゼロ件時の表示要件を追加

### 判定結果
✅ **合格**: 全84項目が明確・完全・一貫・測定可能に定義されています

## メモ

- チェック完了時は `[x]` でマーク
- 発見事項や改善提案はインラインでコメント追加
- 関連リソースやドキュメントへのリンクを追加
- 項目は連番で管理され、参照が容易

---

## チェックリスト使用ガイド

### 使用タイミング
- PR作成前のセルフレビュー
- 仕様書ドラフト完成後の品質確認
- 実装開始前の要件明確化

### チェック方法
1. 各項目を順に確認し、該当する仕様書セクションを参照
2. 要件が明確に定義されていれば `[x]` でマーク
3. 不明確・不足があれば項目下にコメント追加し、仕様書を更新
4. すべてクリア後、PRレビュアーに共有

### 判定基準
- ✅ **合格**: 要件が明確・完全・一貫・測定可能に定義されている
- ⚠️ **要改善**: 曖昧な表現、定義不足、矛盾が存在する
- ❌ **不合格**: 重要な要件が欠落、または重大な矛盾がある
