# Feature Specification: Project and Task Management

**Feature Branch**: `002-task-management`  
**Created**: 2025-11-01  
**Status**: Draft  
**Input**: User description: "Project and task management with CRUD operations for individual developers to organize their development work"

## Clarifications

### Session 2025-11-03

- Q: タスク完了時のAI褒めシステムとの連携について明確化が必要です。タスク完了はモチベーション維持機能の重要なトリガーとなるため、この統合のタイミングと動作を定義する必要があります。 → A: タスク完了後、即座にAI褒めリクエストを非同期で送信し、ユーザーは待たずに次の操作が可能。褒めメッセージは遅延表示される
- Q: プロジェクト内に100個以上のタスクがある場合の表示方式について、ページネーションまたは無限スクロールのどちらを採用するか明確化が必要です。これはパフォーマンスとUXに直接影響します。 → A: 無限スクロール（下にスクロールすると自動的に次の20-30件を読み込む）
- Q: タスク一覧を初期表示する際のデフォルトソート順が未定義です。ユーザーが最初に見るべき情報の優先順位を決定する必要があります。 → A: 作成日時の新しい順（最近作成したタスクが上に表示）
- Q: ネットワーク切断中の操作と、接続復帰時の自動同期について、同期中に競合が発生した場合（例：別デバイスで同じタスクが既に編集されている）の具体的な解決戦略が未定義です。 → A: Last Write Wins（最後の書き込みが優先）+ オフライン変更タイムスタンプ記録
- Q: プロジェクト100%完了時の「プロジェクト完了！」祝福メッセージ表示後のユーザー動線が未定義です。プロジェクト完了は重要なマイルストーンであり、この後の体験設計が必要です。 → A: 祝福メッセージ表示 + AI褒めメッセージ取得（非同期）+ プロジェクト詳細画面に留まる

## User Scenarios & Testing *(mandatory)*

### User Story 1 - Create New Project (Priority: P1)

個人開発者が新しい開発プロジェクトを作成し、プロジェクト名と簡単な説明を設定して、開発作業を組織化できる。

**Why this priority**: タスクを管理する前提として、プロジェクトという入れ物が必要。これがなければタスク管理機能全体が成立しないため、最優先。

**Independent Test**: ユーザーがプロジェクト作成画面からプロジェクト名と説明を入力し、「作成」ボタンを押してプロジェクトリストに新しいプロジェクトが表示されることで独立してテスト可能。

**Acceptance Scenarios**:

1. **Given** ログイン済みユーザーがホーム画面を開いた状態で、**When** 「新規プロジェクト」ボタンをタップし、プロジェクト名「個人ブログアプリ」と説明「Next.jsで構築する技術ブログ」を入力して「作成」ボタンを押す、**Then** プロジェクトが作成され、プロジェクトリストに表示され、自動的にそのプロジェクト詳細画面に遷移する
2. **Given** プロジェクト作成画面を開いた状態で、**When** プロジェクト名を空欄のまま「作成」ボタンを押す、**Then** エラーメッセージ「プロジェクト名を入力してください」が表示され、プロジェクトは作成されない
3. **Given** プロジェクト作成画面を開いた状態で、**When** 既に存在するプロジェクト名と同じ名前を入力して「作成」ボタンを押す、**Then** プロジェクトは作成され、同名のプロジェクトが複数存在できる（重複許可）
4. **Given** プロジェクト作成画面で説明欄に入力した状態で、**When** 説明を空欄のまま「作成」ボタンを押す、**Then** プロジェクトは正常に作成される（説明はオプション）

---

### User Story 2 - View Project List (Priority: P1)

ユーザーが作成したすべてのプロジェクトを一覧表示し、各プロジェクトの進捗状況を確認できる。

**Why this priority**: プロジェクト作成と同等に重要。ユーザーが自分のプロジェクトを見られなければ、タスク管理の意味がない。

**Independent Test**: ユーザーがホーム画面またはプロジェクトタブを開き、作成済みのプロジェクトが一覧表示され、各プロジェクトの名前・説明・進捗率が確認できることで独立してテスト可能。

**Acceptance Scenarios**:

1. **Given** 複数のプロジェクトを作成済みのユーザーがアプリを開いた状態で、**When** ホーム画面またはプロジェクトタブを表示する、**Then** すべてのプロジェクトがカード形式で一覧表示され、各カードにプロジェクト名・説明・タスク完了率（例: 3/10完了）・作成日時が表示される
2. **Given** プロジェクトを1つも作成していないユーザーがアプリを開いた状態で、**When** ホーム画面を表示する、**Then** 空の状態メッセージ「まだプロジェクトがありません。新規プロジェクトを作成しましょう！」と「新規プロジェクト作成」ボタンが表示される
3. **Given** プロジェクトリストが表示されている状態で、**When** 特定のプロジェクトカードをタップする、**Then** そのプロジェクトの詳細画面に遷移し、プロジェクト内のタスク一覧が表示される

---

### User Story 3 - Create Task within Project (Priority: P1)

ユーザーがプロジェクト内に具体的なタスクを作成し、タスク名・説明・期限を設定して開発作業を細分化できる。

**Why this priority**: タスク管理の核心機能。プロジェクトだけでは不十分で、実際の作業単位であるタスクを作成できなければモチベーション維持機能（進捗可視化、AI褒め）に繋がらない。

**Independent Test**: ユーザーがプロジェクト詳細画面から「新規タスク」ボタンをタップし、タスク情報を入力して作成後、タスク一覧に新しいタスクが表示されることで独立してテスト可能。

**Acceptance Scenarios**:

1. **Given** プロジェクト詳細画面を開いた状態で、**When** 「新規タスク」ボタンをタップし、タスク名「ユーザー認証API実装」、説明「Firebase Authを使用」、期限「2025年11月15日」を入力して「作成」ボタンを押す、**Then** タスクが作成され、プロジェクトのタスク一覧に未完了状態で表示される
2. **Given** タスク作成画面を開いた状態で、**When** タスク名を空欄のまま「作成」ボタンを押す、**Then** エラーメッセージ「タスク名を入力してください」が表示され、タスクは作成されない
3. **Given** タスク作成画面で説明と期限を入力した状態で、**When** 説明と期限を空欄のまま（タスク名のみ入力）「作成」ボタンを押す、**Then** タスクは正常に作成される（説明と期限はオプション）
4. **Given** タスク作成画面で期限を選択する状態で、**When** 過去の日付を期限として選択して「作成」ボタンを押す、**Then** タスクは作成されるが、期限超過を示す視覚的インジケーター（赤色等）が表示される

---

### User Story 4 - Mark Task as Complete (Priority: P1)

ユーザーがタスクを完了したときに、タスクを「完了」状態にマークし、進捗状況を更新できる。

**Why this priority**: タスク管理の核心であり、モチベーション維持機能（AI褒め、進捗可視化）のトリガーとなる最重要アクション。

**Independent Test**: ユーザーがタスク一覧から未完了タスクのチェックボックスをタップし、タスクが完了状態になり、プロジェクトの進捗率が更新されることで独立してテスト可能。

**Acceptance Scenarios**:

1. **Given** 未完了タスクが表示されているタスク一覧画面で、**When** タスクのチェックボックスをタップする、**Then** タスクが完了状態になり、チェックマークが表示され、プロジェクトの進捗率が更新され、完了日時が記録される
2. **Given** タスクを完了した直後の状態で、**When** 完了したタスクのチェックボックスを再度タップする、**Then** タスクが未完了状態に戻り、チェックマークが消え、プロジェクトの進捗率が減少する（完了取り消し）
3. **Given** プロジェクト内のすべてのタスクが完了している状態で、**When** 最後の未完了タスクを完了状態にする、**Then** プロジェクトの進捗率が100%になり、「プロジェクト完了！」という祝福メッセージが表示される。同時にAI褒めメッセージが非同期で取得され、到着次第通知形式で表示される。ユーザーはプロジェクト詳細画面に留まり、必要に応じて追加作業やレビューが可能
4. **Given** タスク一覧画面を表示している状態で、**When** 完了済みタスクフィルターを選択する、**Then** 完了したタスクのみが一覧表示され、未完了タスクは非表示になる

---

### User Story 5 - Edit Project and Task (Priority: P2)

ユーザーが作成済みのプロジェクトやタスクの情報（名前、説明、期限等）を編集して、変更内容を保存できる。

**Why this priority**: 基本的なCRUD機能だが、作成・表示・完了マークが動作していれば最初のユーザーテストは可能。ただし、長期的な使用には必須の機能。

**Independent Test**: ユーザーがプロジェクト詳細画面またはタスク詳細画面で「編集」ボタンをタップし、情報を変更して保存後、変更内容が反映されることで独立してテスト可能。

**Acceptance Scenarios**:

1. **Given** プロジェクト詳細画面を開いた状態で、**When** 「編集」ボタンをタップし、プロジェクト名を「個人ブログアプリ v2」に変更して「保存」ボタンを押す、**Then** プロジェクト名が更新され、プロジェクトリストにも反映される
2. **Given** タスク詳細画面を開いた状態で、**When** 「編集」ボタンをタップし、期限を「2025年11月30日」に変更して「保存」ボタンを押す、**Then** タスクの期限が更新され、タスク一覧にも反映される
3. **Given** タスク編集画面でタスク名を編集した状態で、**When** タスク名を空欄にして「保存」ボタンを押す、**Then** エラーメッセージ「タスク名を入力してください」が表示され、変更は保存されない
4. **Given** プロジェクト編集画面を開いた状態で、**When** 「キャンセル」ボタンをタップする、**Then** 編集内容は破棄され、元のプロジェクト詳細画面に戻る

---

### User Story 6 - Delete Project and Task (Priority: P2)

ユーザーが不要になったプロジェクトやタスクを削除し、データを整理できる。

**Why this priority**: 誤って作成した場合や不要になった場合の整理機能として重要だが、基本的なCRUD機能が動作していれば最初のテストは可能。

**Independent Test**: ユーザーがプロジェクト詳細画面またはタスク一覧から「削除」ボタンをタップし、確認ダイアログで削除を確定後、プロジェクトまたはタスクが一覧から消えることで独立してテスト可能。

**Acceptance Scenarios**:

1. **Given** プロジェクト詳細画面を開いた状態で、**When** 「削除」ボタンをタップし、確認ダイアログで「削除する」を選択する、**Then** プロジェクトとそのプロジェクト内のすべてのタスクが削除され、プロジェクトリスト画面に戻る
2. **Given** タスク一覧画面でタスクを左スワイプした状態で、**When** 「削除」ボタンをタップし、確認ダイアログで「削除する」を選択する、**Then** タスクが削除され、プロジェクトの進捗率が再計算される
3. **Given** プロジェクト削除の確認ダイアログが表示された状態で、**When** 「キャンセル」ボタンをタップする、**Then** 削除は実行されず、元のプロジェクト詳細画面に戻る
4. **Given** タスクを含むプロジェクトの削除確認ダイアログが表示された状態で、**When** 「削除する」を選択する、**Then** 警告メッセージ「このプロジェクトには○個のタスクが含まれています。すべて削除されます」が表示され、確認後に削除が実行される

---

### User Story 7 - Sort and Filter Tasks (Priority: P3)

ユーザーがタスク一覧を並び替えたり、フィルター（未完了/完了/期限順等）をかけて、優先的に取り組むべきタスクを見つけやすくできる。

**Why this priority**: ユーザー体験を向上させる便利機能だが、基本的なタスク管理が動作していれば最初のテストは可能。タスク数が増えてから重要性が増す。

**Independent Test**: ユーザーがタスク一覧画面でフィルター・ソートオプションを選択し、タスクの表示順序や表示内容が変更されることで独立してテスト可能。

**Acceptance Scenarios**:

1. **Given** タスク一覧画面を開いた状態で、**When** 「期限順」ソートを選択する、**Then** タスクが期限の近い順に並び替えられ、期限なしのタスクは最後に表示される
2. **Given** タスク一覧画面でフィルターメニューを開いた状態で、**When** 「未完了のみ」フィルターを選択する、**Then** 未完了タスクのみが表示され、完了済みタスクは非表示になる
3. **Given** タスク一覧画面でフィルターメニューを開いた状態で、**When** 「期限超過」フィルターを選択する、**Then** 期限が過ぎているのに未完了のタスクのみが表示され、赤色で強調される

---

### Edge Cases

- **ネットワーク切断時**: タスク作成・更新中にネットワーク接続が切れた場合、ローカルに一時保存し、接続復帰時に自動同期する。同期競合が発生した場合はLast Write Wins戦略を採用し、最後の書き込みが優先される。オフライン変更のタイムスタンプを記録することで、必要に応じて競合検出・通知が可能
- **同時編集**: 複数デバイスから同じプロジェクト/タスクを同時に編集した場合、最後の更新が優先される（Last Write Wins）。Firestoreの標準動作に準拠し、シンプルな競合解決戦略を採用
- **大量タスク**: プロジェクト内に100個以上のタスクがある場合、無限スクロール方式で表示する。初期表示は最新20-30件、下方向にスクロールすると自動的に次の20-30件を読み込む。Firestoreのクエリカーソルを使用してページング処理を実装する
- **空プロジェクト削除**: タスクが1つもないプロジェクトを削除する際は、簡易的な確認ダイアログのみ表示
- **完了タスクの削除**: 完了済みタスクを削除しても、プロジェクトの進捗率には影響しない（完了タスク数は減るが、完了率の計算方法を維持）

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムはユーザーがプロジェクトを作成できなければならず、プロジェクト名（必須）と説明（オプション）を入力できなければならない
- **FR-002**: システムはユーザーが作成したすべてのプロジェクトを一覧表示し、各プロジェクトの名前・説明・タスク完了率・作成日時を表示しなければならない
- **FR-003**: システムは空のプロジェクトリストの場合、適切なメッセージと新規作成ボタンを表示しなければならない
- **FR-004**: システムはユーザーがプロジェクト内にタスクを作成できなければならず、タスク名（必須）、説明（オプション）、期限（オプション）を入力できなければならない
- **FR-005**: システムはタスク名が空欄の場合、エラーメッセージを表示してタスク作成を防止しなければならない
- **FR-006**: システムはユーザーがタスクを完了状態または未完了状態にマークできなければならない
- **FR-007**: システムはタスクが完了状態になったときに、完了日時を自動的に記録しなければならない
- **FR-008**: システムはプロジェクトの進捗率を「完了タスク数 / 総タスク数 × 100」で自動計算し、表示しなければならない
- **FR-009**: システムはプロジェクトとタスクの編集機能を提供し、名前・説明・期限等を変更できなければならない（P2）
- **FR-010**: システムはプロジェクト削除時に、プロジェクト内のすべてのタスクも連動して削除しなければならない（P2）
- **FR-011**: システムはプロジェクトまたはタスク削除時に、確認ダイアログを表示し、誤削除を防止しなければならない（P2）
- **FR-012**: システムはタスク一覧を期限順・作成日順・完了状態でソート・フィルタリングできなければならない（P3）。デフォルトのソート順は作成日時の新しい順とする
- **FR-013**: システムはネットワーク切断時にローカルストレージにデータを一時保存し、接続復帰時に自動同期しなければならない。同期競合時はLast Write Wins戦略を採用し、オフライン変更タイムスタンプを記録する
- **FR-014**: システムはプロジェクトとタスクの作成・更新・削除操作中にローディングインジケーターを表示し、ユーザーに処理状態をフィードバックしなければならない
- **FR-015**: システムはタスク完了時、AI褒めシステムへのリクエストを非同期で送信し、ユーザーを待たせることなく次の操作を可能にしなければならない。AI褒めメッセージは到着次第、通知またはトースト形式で遅延表示される
- **FR-016**: システムはプロジェクトの進捗率が100%に達した時、「プロジェクト完了！」という祝福メッセージを表示し、同時にAI褒めメッセージを非同期で取得しなければならない。ユーザーはプロジェクト詳細画面に留まり、追加作業やレビューが可能な状態を維持する

### Key Entities

- **Project**: 個人開発プロジェクトを表す
  - 属性: プロジェクトID（一意）、名前（必須）、説明（オプション）、作成日時、更新日時、所有者ユーザーID
  - 関係性: 1プロジェクトは複数のTaskを持つ（1対多）

- **Task**: プロジェクト内の具体的な作業タスクを表す
  - 属性: タスクID（一意）、名前（必須）、説明（オプション）、期限（オプション）、完了状態（boolean）、作成日時、更新日時、完了日時（完了時のみ）、所属プロジェクトID
  - 関係性: 1タスクは1プロジェクトに属する（多対1）

- **Progress Metrics**: プロジェクトの進捗情報（計算値）
  - 属性: 総タスク数、完了タスク数、完了率（%）、期限超過タスク数
  - 関係性: 各Projectに対して動的に計算される

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: ユーザーが新規プロジェクトを作成してからプロジェクトリストに表示されるまでの時間が3秒以内である
- **SC-002**: ユーザーが新規タスクを作成してからタスク一覧に表示されるまでの時間が2秒以内である
- **SC-003**: タスクの完了マーク操作から進捗率更新までの反応時間が1秒以内である
- **SC-004**: プロジェクトとタスクのCRUD操作の95%以上がエラーなく成功する（ネットワーク問題を除く）
- **SC-005**: ユーザーの90%以上がプロジェクト作成からタスク作成・完了マークまでの基本操作を5分以内に理解できる
- **SC-006**: タスク一覧に100個のタスクが表示されている場合でも、スクロールが60fpsで滑らかに動作する（P3目標）
- **SC-007**: ネットワーク切断中のオフライン操作が接続復帰後5秒以内に自動同期される

## Assumptions

- ユーザーは既にアカウント作成とログインを完了している（001-user-auth依存）
- プロジェクトとタスクのデータはCloud Firestoreに保存される
- 1ユーザーあたりのプロジェクト数上限は初期段階では設定しない（将来的にプレミアムプランで制限する可能性）
- タスクの優先度設定機能は将来のPhaseで追加する（Phase 0では実装しない）
- タスクの依存関係機能（タスクAが完了したらタスクBを開始）は将来のPhaseで検討する
- サブタスク機能（タスク内のチェックリスト）は将来のPhaseで追加する
- プロジェクトとタスクのデータ同期はFirestore Realtime Listenersで自動的に処理される
- 削除されたプロジェクトとタスクは物理削除され、復元機能は提供しない（将来的にゴミ箱機能を検討）

## Dependencies

- 001-user-auth機能（ユーザー認証とユーザーID取得に依存）
- Cloud Firestore SDK（Flutter用）
- インターネット接続（オンライン操作時必須、オフライン対応はローカルキャッシュで補完）

## Out of Scope (Phase 0)

以下の機能は Phase 0 では実装せず、将来のPhaseで検討する:

- タスクの優先度設定（High/Medium/Low）
- タスクの依存関係管理
- サブタスク・チェックリスト機能
- タスクへのタグ付け・ラベル機能
- プロジェクトのアーカイブ機能
- プロジェクトとタスクの検索機能
- タスクのリマインダー・通知機能（Phase 1で実装予定）
- プロジェクトの共有・コラボレーション機能
- タスクの繰り返し設定（毎日/毎週等）
- ガントチャート・カレンダー表示
- タスクの時間トラッキング機能
- プロジェクトテンプレート機能
