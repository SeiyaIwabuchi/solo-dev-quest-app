# マージ順序

## ブランチ戦略

```
┌─────────────────────────────────────────────────────────────────────┐
│                            main Branch                               │
│                    (最新統合ブランチ・開発起点)                      │
└──┬───────┬───────┬───────┬───────┬───────┬─────────────────────────┘
   │       │       │       │       │       │
   │ 作成  │ 作成  │ 作成  │ 作成  │ 作成  │ 作成
   │       │       │       │       │       │
   v       v       v       v       v       v
┌─────────────────────────────────────────────────────────────────────┐
│                          Feature Branches                            │
│  (各機能開発ブランチ: 001-user-auth, 002-task-management, etc.)      │
└────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────────┘
     │         │         │         │         │         │
     │         │         │         │         │         │
     v         v         v         v         v         v
001-user-  002-task-  003-comm-  004-adv-  005-scal-  00X-xxxxx
  auth     management  unity     anced-ai   ing       -xxxxx
   │         │         │         │         │         │
   │         │         │         │         │         │
   │ PR      │ PR      │ PR      │ PR      │ PR      │ PR
   └─────────┴─────────┴─────────┴─────────┴─────────┴──────────┐
                                                                  │
                                                                  v
┌─────────────────────────────────────────────────────────────────────┐
│                          Release Branch                              │
│                  (本番環境デプロイ・App Store公開)                   │
└──────────────────────────────────────┬──────────────────────────────┘
                                       │
                                       │ PR (最新統合)
                                       │
                                       v
┌─────────────────────────────────────────────────────────────────────┐
│                            main Branch                               │
│                    (最新統合ブランチ・次期開発準備)                  │
└─────────────────────────────────────────────────────────────────────┘
```

## マージフロー詳細

### 0. main Branch → Feature Branch (開発開始)

```
main Branch ────────> 001-user-auth
            ────────> 002-task-management
            ────────> 003-community
            ────────> 004-advanced-ai
            ────────> 005-scaling
            ────────> 00X-xxxxx-xxxxx
```

**手順**:
1. mainブランチから新規Feature branchを作成
2. Feature branchで開発作業
3. ローカルでのテスト・検証

---

### 1. Feature Branches → Release Branch

```
001-user-auth ──────┐
                    │
002-task-management ┤
                    │
003-community ──────┤
                    ├──> Release Branch (本番環境)
004-advanced-ai ────┤
                    │
005-scaling ────────┤
                    │
00X-xxxxx-xxxxx ────┘
```

**手順**:
1. Feature branch開発完了
2. Feature branch → Release branchへPR作成
3. コードレビュー + CI/CD合格
4. Release branchへマージ
5. 本番環境へ自動デプロイ

**合格基準**:
- ✅ すべてのユニットテスト合格
- ✅ Integration Test合格
- ✅ 憲法チェック(Constitution Check)合格
- ✅ コードレビュー承認
- ✅ 本番デプロイ前最終確認

---

### 2. Release Branch → main Branch

```
Release Branch ────────> main Branch
(本番公開済み)          (最新統合ブランチ)
```

**手順**:
1. Release branchで本番デプロイ完了
2. Release branch → main branchへPR作成
3. main branchへマージ(最新状態を同期)
4. 次期開発の準備完了

**合格基準**:
- ✅ Release branchの本番デプロイが正常完了
- ✅ 本番環境でのヘルスチェック合格
- ✅ リリースノート作成完了
- ✅ 最終本番デプロイ承認

---

## ブランチ命名規則

### Feature Branches

```
00X-feature-name
```

**例**:
- `001-user-auth` (Phase 0: ユーザー認証)
- `002-task-management` (Phase 1: タスク管理)
- `003-community-features` (Phase 2: コミュニティ機能)
- `004-advanced-ai` (Phase 3: 高度なAI機能)
- `005-scaling-optimization` (Phase 4: スケーリング・最適化)

### main Branch

```
main
```

**役割**:
- 最新統合ブランチ
- すべてのFeature branchの作成起点
- Release branchから本番公開完了後にマージされる
- すべての本番リリース履歴を統合
- 次期開発の開始ベースライン

### Feature Branches

```
001-user-auth
002-task-management
003-community
...
```

**役割**:
- mainブランチから作成
- 各機能の個別開発
- 開発完了後、Release branchへPR

### Release Branch

```
release
```

**役割**:
- 本番環境デプロイブランチ
- すべてのFeature branchがマージされる
- App Store / Google Playへのデプロイソース
- 常に本番環境の最新公開版を維持
- ユーザーに実際に提供されるコード

### Hotfix Branches

```
hotfix/issue-description
```

**例**:
- `hotfix/login-crash` (ログインクラッシュ修正)
- `hotfix/security-patch` (セキュリティパッチ)

---

## CI/CDパイプライン

### Feature Branch CI

```
Feature Branch Push
     │
     ├─> Lint & Format Check
     ├─> Unit Tests
     ├─> Widget Tests
     ├─> Constitution Check
     └─> Build Test
```

### Release Branch CI/CD

```
Release Branch Merge
     │
     ├─> Lint & Format Check
     ├─> All Tests (Unit/Widget/Integration/E2E)
     ├─> Constitution Check
     ├─> Security Scan
     ├─> Performance Test
     ├─> Build Production (iOS/Android/Web)
     ├─> Deploy to Firebase Hosting (Web)
     ├─> Deploy to App Store / Google Play (Mobile)
     └─> Production Health Check
```

### main Branch CI

```
main Branch Merge
     │
     ├─> Lint & Format Check
     ├─> Update Release History
     ├─> Generate Release Notes
     ├─> Tag Version
     └─> Archive Build Artifacts
```

---

## バージョニング戦略

### セマンティックバージョニング

```
vMAJOR.MINOR.PATCH

例: v1.2.3
```

- **MAJOR**: 破壊的変更 (Phase間の大きな変更)
- **MINOR**: 後方互換性のある機能追加 (新User Story追加)
- **PATCH**: バグ修正・軽微な改善

### Phaseとバージョンの対応

| Phase | Version | Feature Branches |
|-------|---------|------------------|
| Phase 0 | v0.1.0 | 001-user-auth |
| Phase 1 | v1.0.0 | 002-task-management, 006-ai-praise, 007-visualization, 008-devcoin |
| Phase 2 | v1.1.0 | 003-community-features |
| Phase 3 | v1.2.0 | 004-advanced-ai |
| Phase 4 | v1.3.0 | 005-scaling-optimization |

---

## リリースフロー例

### Phase 0リリース (v0.1.0)

```
1. mainから001-user-authブランチ作成
        ↓
2. 001-user-auth開発完了
        ↓
3. 001-user-auth → releaseへPR
        ↓
4. releaseへマージ
        ↓
5. タグv0.1.0作成
        ↓
6. 本番デプロイ (Firebase Hosting / App Store / Google Play)
        ↓
7. 本番公開確認
        ↓
8. release → mainへPR
        ↓
9. mainへマージ (最新統合完了)
```

### Phase 1リリース (v1.0.0)

```
1. mainから各ブランチ作成
   (002-task-management, 006-ai-praise, 
    007-visualization, 008-devcoin)
        ↓
2. 各ブランチで並行開発
        ↓
3. 開発完了
        ↓
4. 各ブランチ → releaseへPR (順次マージ)
        ↓
5. releaseへマージ完了
        ↓
6. タグv1.0.0作成
        ↓
7. 本番デプロイ (App Store / Google Play申請)
        ↓
8. 本番公開確認
        ↓
9. release → mainへPR
        ↓
10. mainへマージ (最新統合完了)
```

---

## Hotfixフロー

```
Release Branch (v1.0.0) [本番環境]
     │
     │ (バグ発見)
     │
     ├─> hotfix/issue-description
     │        │
     │        │ (バグ修正)
     │        │
     │        └─> hotfix/issue-description → release PR
     │
     ├─> Release Branch (v1.0.1) [緊急本番デプロイ]
     │
     │ (本番公開完了)
     │
     └─> release → main PR
              │
              └─> main Branch (v1.0.1同期)
```

**手順**:
1. releaseブランチからhotfixブランチ作成
2. バグ修正
3. hotfix → release PR作成・マージ
4. v1.0.1タグ作成
5. 緊急本番デプロイ
6. 本番公開確認後、release → main PR作成・マージ
